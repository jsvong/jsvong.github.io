<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>亲爱的我把 Tumblr 反向代理了 - == TL;DR ==</title>
  <meta name="description" content="content {:toc}  序 终于搬砖将自己的 Tumblr 重新搭好，然后发现xx移动把 Tumblr 墙了👀。决定用「反向代理」这种简单粗暴直接的方式实现无阻碍访问。
 过程 初始设置 一般会使用 Nginx 来做反向代理。找到了一个现成配置是用来反向代理 Tumblr 的：
(via Wood Tale)
在自己的 VPS 服务器上照此设置了 Nginx，然并卵，实际使用中所有的图片仍然显示不出来。
 问题分析 Tumblr 把图片分为两种：装饰网页用的底图、logo 等等，以及发表内容时上传的照片、动图等。前者被 Tumblr 统一放在了 static.tumblr.com 服务器上，后者所在的服务器则使用了 数字.media.tumblr.com 这种形式的子域名。
事实上除了图片，Tumblr 还会在类似 assets.tumblr.com 这样的服务器上放置一些 JS 代码。所以，需要针对所有这些服务器设置反向代理。
 改进设置 利用 Nginx 的 sub_filter，先把页面中所有的 tumblr.com 替换为 sample.com，即添加这行：
(注#1：并不是所有 Nginx 的版本都支持超过一个 sub_filter，所以请更新 Nginx 到最新版。)
(注#2：个人域名的 DNS 服务商最好支持 catch-all，即对 *.sample.com 这种形式的解析，这样就不用额外处理每一个子域名。)
之后利用正则表达式和变量，配置对上述服务器的反向代理：
server { listen 80; server_name ~^(?&lt;subdomain&gt;\S&#43;)\.sample\.com$; location / { resolver 8."><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "== TL;DR ==",
    
    "url": "https:\/\/tldr.jsv.me\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/tldr.jsv.me\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/tldr.jsv.me\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/tldr.jsv.me\/posts\/reverse-proxy-tumblr\/",
          "name": "亲爱的我把 tumblr 反向代理了"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "me"
  },
  "headline": "亲爱的我把 Tumblr 反向代理了",
  "description" : "content {:toc}  序 终于搬砖将自己的 Tumblr 重新搭好，然后发现xx移动把 Tumblr 墙了👀。决定用「反向代理」这种简单粗暴直接的方式实现无阻碍访问。\n 过程 初始设置 一般会使用 Nginx 来做反向代理。找到了一个现成配置是用来反向代理 Tumblr 的：\n(via Wood Tale)\n在自己的 VPS 服务器上照此设置了 Nginx，然并卵，实际使用中所有的图片仍然显示不出来。\n 问题分析 Tumblr 把图片分为两种：装饰网页用的底图、logo 等等，以及发表内容时上传的照片、动图等。前者被 Tumblr 统一放在了 static.tumblr.com 服务器上，后者所在的服务器则使用了 数字.media.tumblr.com 这种形式的子域名。\n事实上除了图片，Tumblr 还会在类似 assets.tumblr.com 这样的服务器上放置一些 JS 代码。所以，需要针对所有这些服务器设置反向代理。\n 改进设置 利用 Nginx 的 sub_filter，先把页面中所有的 tumblr.com 替换为 sample.com，即添加这行：\n(注#1：并不是所有 Nginx 的版本都支持超过一个 sub_filter，所以请更新 Nginx 到最新版。)\n(注#2：个人域名的 DNS 服务商最好支持 catch-all，即对 *.sample.com 这种形式的解析，这样就不用额外处理每一个子域名。)\n之后利用正则表达式和变量，配置对上述服务器的反向代理：\nserver { listen 80; server_name ~^(?\u0026lt;subdomain\u0026gt;\\S\u002b)\\.sample\\.com$; location \/ { resolver 8.",
  "inLanguage" : "en",
  "wordCount":  225 ,
  "datePublished" : "0001-01-01T00:00:00",
  "dateModified" : "0001-01-01T00:00:00",
  "image" : "https:\/\/tldr.jsv.me\/",
  "keywords" : [ "" ],
  "mainEntityOfPage" : "https:\/\/tldr.jsv.me\/posts\/reverse-proxy-tumblr\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/tldr.jsv.me\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/tldr.jsv.me\/",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="亲爱的我把 Tumblr 反向代理了" />
<meta property="og:description" content="content {:toc}  序 终于搬砖将自己的 Tumblr 重新搭好，然后发现xx移动把 Tumblr 墙了👀。决定用「反向代理」这种简单粗暴直接的方式实现无阻碍访问。
 过程 初始设置 一般会使用 Nginx 来做反向代理。找到了一个现成配置是用来反向代理 Tumblr 的：
(via Wood Tale)
在自己的 VPS 服务器上照此设置了 Nginx，然并卵，实际使用中所有的图片仍然显示不出来。
 问题分析 Tumblr 把图片分为两种：装饰网页用的底图、logo 等等，以及发表内容时上传的照片、动图等。前者被 Tumblr 统一放在了 static.tumblr.com 服务器上，后者所在的服务器则使用了 数字.media.tumblr.com 这种形式的子域名。
事实上除了图片，Tumblr 还会在类似 assets.tumblr.com 这样的服务器上放置一些 JS 代码。所以，需要针对所有这些服务器设置反向代理。
 改进设置 利用 Nginx 的 sub_filter，先把页面中所有的 tumblr.com 替换为 sample.com，即添加这行：
(注#1：并不是所有 Nginx 的版本都支持超过一个 sub_filter，所以请更新 Nginx 到最新版。)
(注#2：个人域名的 DNS 服务商最好支持 catch-all，即对 *.sample.com 这种形式的解析，这样就不用额外处理每一个子域名。)
之后利用正则表达式和变量，配置对上述服务器的反向代理：
server { listen 80; server_name ~^(?&lt;subdomain&gt;\S&#43;)\.sample\.com$; location / { resolver 8.">
<meta property="og:url" content="https://tldr.jsv.me/posts/reverse-proxy-tumblr/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="== TL;DR ==" />

  <meta name="twitter:title" content="亲爱的我把 Tumblr 反向代理了" />
  <meta name="twitter:description" content="content {:toc}  序 终于搬砖将自己的 Tumblr 重新搭好，然后发现xx移动把 Tumblr 墙了👀。决定用「反向代理」这种简单粗暴直接的方式实现无阻碍访问。
 过程 初始设置 一般会使用 Nginx 来做反向代理。找到了一个现成配置是用来反向代理 Tumblr 的：
(via Wood Tale)
在自己的 VPS 服务器上照此设置了 Nginx，然并卵，实际使用中所有的图片仍 …">
  <meta name="twitter:card" content="summary" />
  <meta name="generator" content="Hugo 0.74.3" />
  <link rel="alternate" href="https://tldr.jsv.me/index.xml" type="application/rss+xml" title="== TL;DR =="><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://tldr.jsv.me/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="https://tldr.jsv.me/css/syntax.css" /><link rel="stylesheet" href="https://tldr.jsv.me/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://tldr.jsv.me/">== TL;DR ==</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        

        

        
      </ul>
    </div>

    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="posts-heading">
              
                <h1>亲爱的我把 Tumblr 反向代理了</h1>
              
              
                <hr class="small">
              
              
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <ul>
<li>content
{:toc}</li>
</ul>
<h2 id="序">序</h2>
<p>终于搬砖将自己的 Tumblr 重新搭好，然后发现xx移动把 Tumblr 墙了👀。决定用「反向代理」这种简单粗暴直接的方式实现无阻碍访问。</p>
<hr>
<h2 id="过程">过程</h2>
<h3 id="初始设置">初始设置</h3>
<p>一般会使用 Nginx 来做反向代理。找到了一个现成配置是用来反向代理 Tumblr 的：</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>(via <a href="http://adaromu.tumblr.com/post/33722081482/nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86tumblr%E9%85%8D%E7%BD%AE">Wood Tale</a>)</p>
<p>在自己的 VPS 服务器上照此设置了 Nginx，然并卵，实际使用中所有的图片仍然显示不出来。</p>
<hr>
<h3 id="问题分析">问题分析</h3>
<p>Tumblr 把图片分为两种：装饰网页用的底图、logo 等等，以及发表内容时上传的照片、动图等。前者被 Tumblr 统一放在了 <code>static.tumblr.com</code> 服务器上，后者所在的服务器则使用了 <code>数字.media.tumblr.com</code> 这种形式的子域名。</p>
<p>事实上除了图片，Tumblr 还会在类似 <code>assets.tumblr.com</code> 这样的服务器上放置一些 JS 代码。所以，需要针对所有这些服务器设置反向代理。</p>
<hr>
<h3 id="改进设置">改进设置</h3>
<p>利用 Nginx 的 <code>sub_filter</code>，先把页面中所有的 <code>tumblr.com</code> 替换为 <code>sample.com</code>，即添加这行：</p>
<!-- raw HTML omitted -->
<p>(注#1：并不是所有 Nginx 的版本都支持超过一个 <code>sub_filter</code>，所以请更新 Nginx 到最新版。)<br>
(注#2：个人域名的 DNS 服务商最好支持 <code>catch-all</code>，即对 <code>*.sample.com</code> 这种形式的解析，这样就不用额外处理每一个子域名。)</p>
<p>之后利用正则表达式和变量，配置对上述服务器的反向代理：</p>
<pre><code>server
{
listen 80;
server_name ~^(?&lt;subdomain&gt;\S+)\.sample\.com$;

location / {
resolver 8.8.8.8;
proxy_pass http://$subdomain.tumblr.com;
proxy_redirect off;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header Accept-Encoding &quot;&quot;;
}

}
</code></pre>
<p>(这里必须加一行 <code>resolver</code> 来作 DNS 解析，否则 Nginx 会报错。)</p>
<p>经测试，这样配置后图片就可以显示出来了。</p>
<hr>
<h3 id="进阶">进阶</h3>
<p>目前有一个「不完美」的地方，即 <code>sample.tumblr.com</code> 仍可被单独访问。虽然 <code>blog.sample.com</code> 只是反向代理到 <code>sample.tumblr.com</code>，但对搜索引擎来说它们是内容完全相同但域名不同的两个网站，不利于 SEO。既然 Tumblr 支持个人域名，最好的办法就是实现「一个域名同时指向 Tumblr 和反向代理服务器」。可以利用 DNSPod 的多线路解析，即国外访问 <code>blog.sample.com</code> 时，指向的是 Tumblr 的服务器 IP，而国内访问 <code>blog.sample.com</code> 时，指向的是反向代理服务器 IP。</p>
<p>综上，进一步修改 Nginx 配置的完整结果：</p>
<pre><code>server
{
listen 80;
server_name blog.sample.com;

location / {
proxy_pass http://66.6.44.4;
proxy_redirect off;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header Host $http_host;
proxy_set_header Accept-Encoding &quot;&quot;;
}

sub_filter 'tumblr.com' 'sample.com';
sub_filter_once off;
}


server
{
listen 80;
server_name ~^(?&lt;subdomain&gt;\S+)\.sample\.com;

location / {
resolver 8.8.8.8;
proxy_pass http://$subdomain.tumblr.com;
proxy_redirect off;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header Accept-Encoding &quot;&quot;;
}

}
</code></pre>
<hr>
<h2 id="总结">总结</h2>
<ul>
<li>使用个人域名 <code>sample.com</code>，并将域名 DNS 托管给 DNSPod；</li>
<li>在 Tumblr 上将 URL 设为个人域名：<code>blog.sample.com</code>；</li>
<li>在 VPS 或任何可安装 Nginx 的服务器上，按上述进行设置；</li>
<li>在 DNSPod 上将 <code>blog.sample.com</code> 设为多线路解析，国内解析到 Nginx 服务器 IP，默认则解析到 Tumblr 的 IP；</li>
<li>在 DNSPod 上将 <code>*.sample.com</code> 解析到 Nginx 服务器 IP。</li>
</ul>
<hr>
<h2 id="参考">参考</h2>
<ul>
<li><a href="http://adaromu.tumblr.com/post/33722081482/nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86tumblr%E9%85%8D%E7%BD%AE">Nginx反向代理Tumblr配置</a></li>
<li><a href="http://jyorr.com/post/4085366506/reverse-proxying-for-tumblr-w-nginx">Reverse proxying for Tumblr w/ Nginx</a></li>
<li><a href="http://www.storyday.com/html/y2012/3165_on-tumblr-reverse-agent.html">关于tumblr反向代理</a></li>
<li><a href="http://webmasters.stackexchange.com/questions/55698/nginx-reverse-proxy-for-tumblr">Nginx Reverse Proxy for Tumblr</a></li>
</ul>


        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
          
        </ul>
      


      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;&copy;
          
            0001
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://tldr.jsv.me/">== TL;DR ==</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.74.3</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://tldr.jsv.me/js/main.js"></script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://tldr.jsv.me/js/load-photoswipe.js"></script>









    
  </body>
</html>

